<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5f5f5;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        canvas {
            display: block;
            max-width: 100%;
            max-height: 100%;
        }
        
        #game-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 100%;
            max-height: 700px;
        }
        
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 10;
        }
        
        .btn {
            padding: 12px 24px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #3367d6;
        }
        
        h1, h2 {
            margin: 10px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Start screen overlay -->
        <div id="start-screen" class="overlay">
            <h1>Flappy Bird</h1>
            <p>Tap or press SPACE to flap</p>
            <button id="start-btn" class="btn">Start Game</button>
        </div>
        
        <!-- Game over overlay -->
        <div id="game-over" class="overlay" style="display: none;">
            <h1>Game Over</h1>
            <h2>Score: <span id="final-score">0</span></h2>
            <button id="restart-btn" class="btn">Restart Game</button>
        </div>
    </div>

    <script>
        // Game variables
        let bird;
        let pipes = [];
        let gravity = 0.6;
        let jumpForce = -10;
        let score = 0;
        let gameOver = false;
        let gameStarted = false;
        let pipeSpawnTimer = 0;
        let pipeSpawnInterval = 120; // Frames between pipe spawns
        
        // DOM elements
        let startScreen;
        let gameOverScreen;
        let finalScoreElement;
        
        // Responsive sizing
        let gameWidth;
        let gameHeight;
        let scaleFactor;
        
        // Bird class
        class Bird {
            constructor() {
                this.x = gameWidth * 0.2;
                this.y = gameHeight / 2;
                this.size = gameHeight * 0.04;
                this.velocity = 0;
                
                // Create simple bird sprite colors
                this.bodyColor = color(255, 204, 0); // Yellow
                this.wingColor = color(255, 153, 0); // Orange
                this.eyeColor = color(0);
                this.beakColor = color(255, 102, 0); // Dark Orange
            }
            
            update() {
                // Apply gravity
                this.velocity += gravity;
                this.y += this.velocity;
                
                // Constrain to screen bounds
                if (this.y > gameHeight - this.size/2) {
                    this.y = gameHeight - this.size/2;
                    this.velocity = 0;
                    gameOver = true;
                }
                
                if (this.y < this.size/2) {
                    this.y = this.size/2;
                    this.velocity = 0;
                    gameOver = true;
                }
            }
            
            jump() {
                this.velocity = jumpForce;
            }
            
            display() {
                push();
                translate(this.x, this.y);
                rotate(map(this.velocity, -10, 10, -PI/6, PI/4));
                
                // Bird body
                fill(this.bodyColor);
                ellipse(0, 0, this.size, this.size * 0.8);
                
                // Wing
                fill(this.wingColor);
                let wingOffset = sin(frameCount * 0.3) * 2; // Wing flap animation
                if (!gameStarted || gameOver) {
                    wingOffset = 0; // No flapping when not playing
                }
                ellipse(0, wingOffset, this.size * 0.8, this.size * 0.4);
                
                // Eye
                fill(this.eyeColor);
                ellipse(this.size * 0.2, -this.size * 0.1, this.size * 0.15, this.size * 0.15);
                
                // Beak
                fill(this.beakColor);
                triangle(
                    this.size * 0.4, -this.size * 0.05,
                    this.size * 0.4, this.size * 0.05,
                    this.size * 0.6, 0
                );
                
                pop();
            }
            
            collidesWith(pipe) {
                let birdLeft = this.x - this.size/2;
                let birdRight = this.x + this.size/2;
                let birdTop = this.y - this.size/2;
                let birdBottom = this.y + this.size/2;
                
                // Simplified circle-rectangle collision
                if (birdRight > pipe.x && birdLeft < pipe.x + pipe.width) {
                    if (birdTop < pipe.topHeight || birdBottom > gameHeight - pipe.bottomHeight) {
                        return true;
                    }
                }
                
                return false;
            }
            
            reset() {
                this.y = gameHeight / 2;
                this.velocity = 0;
            }
        }
        
        // Pipe class
        class Pipe {
            constructor() {
                this.width = gameWidth * 0.1;
                this.x = gameWidth;
                this.gapSize = gameHeight * 0.25;
                this.minHeight = gameHeight * 0.1;
                
                // Random gap position
                let maxGapPos = gameHeight - this.gapSize - this.minHeight * 2;
                let gapPos = this.minHeight + random(maxGapPos);
                
                this.topHeight = gapPos;
                this.bottomHeight = gameHeight - gapPos - this.gapSize;
                this.speed = gameWidth * 0.003;
                this.passed = false;
                this.color = color(76, 175, 80); // Green color
            }
            
            update() {
                this.x -= this.speed;
                
                // Check if the bird has passed this pipe
                if (!this.passed && this.x + this.width < bird.x) {
                    score++;
                    this.passed = true;
                }
            }
            
            display() {
                fill(this.color);
                
                // Top pipe
                rect(this.x, 0, this.width, this.topHeight);
                
                // Bottom pipe
                rect(this.x, gameHeight - this.bottomHeight, this.width, this.bottomHeight);
                
                // Pipe caps
                fill(this.color.levels[0] - 20, this.color.levels[1] - 20, this.color.levels[2] - 20);
                rect(this.x - 5, this.topHeight - 15, this.width + 10, 15);
                rect(this.x - 5, gameHeight - this.bottomHeight, this.width + 10, 15);
            }
            
            isOffscreen() {
                return this.x + this.width < 0;
            }
        }
        
        // p5.js setup function
        function setup() {
            // Get DOM elements
            startScreen = document.getElementById('start-screen');
            gameOverScreen = document.getElementById('game-over');
            finalScoreElement = document.getElementById('final-score');
            
            // Set up button event listeners
            document.getElementById('start-btn').addEventListener('click', startGame);
            document.getElementById('restart-btn').addEventListener('click', restartGame);
            
            // Calculate canvas size based on container
            let container = document.getElementById('game-container');
            let containerWidth = container.clientWidth;
            let containerHeight = container.clientHeight;
            
            // Set game dimensions
            gameWidth = Math.min(containerWidth, containerHeight * 0.7);
            gameHeight = Math.min(containerHeight, containerWidth * 1.4);
            
            // Create canvas inside container
            let canvas = createCanvas(gameWidth, gameHeight);
            canvas.parent('game-container');
            
            // Create bird
            bird = new Bird();
            
            // Set up keyboard and touch/mouse events
            window.addEventListener('keydown', handleKeyDown);
            canvas.touchStarted(handleTap);
            canvas.mousePressed(handleTap);
            
            // Set text properties
            textAlign(CENTER, CENTER);
            textSize(gameHeight * 0.05);
        }
        
        // p5.js draw function (game loop)
        function draw() {
            // Clear background
            background(220);
            
            if (gameStarted) {
                // Update and display bird
                if (!gameOver) {
                    bird.update();
                    
                    // Spawn new pipes
                    pipeSpawnTimer++;
                    if (pipeSpawnTimer >= pipeSpawnInterval) {
                        pipes.push(new Pipe());
                        pipeSpawnTimer = 0;
                    }
                    
                    // Update pipes
                    for (let i = pipes.length - 1; i >= 0; i--) {
                        pipes[i].update();
                        
                        // Check for collision
                        if (bird.collidesWith(pipes[i])) {
                            gameOver = true;
                        }
                        
                        // Remove off-screen pipes
                        if (pipes[i].isOffscreen()) {
                            pipes.splice(i, 1);
                        }
                    }
                }
                
                // Display pipes
                for (let pipe of pipes) {
                    pipe.display();
                }
                
                // Display bird
                bird.display();
                
                // Display score
                fill(0);
                text(score, gameWidth / 2, gameHeight * 0.1);
                
                // Check for game over
                if (gameOver) {
                    finalScoreElement.textContent = score;
                    gameOverScreen.style.display = 'flex';
                }
            }
        }
        
        function startGame() {
            gameStarted = true;
            gameOver = false;
            score = 0;
            pipes = [];
            bird.reset();
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
        }
        
        function restartGame() {
            gameStarted = true;
            gameOver = false;
            score = 0;
            pipes = [];
            bird.reset();
            gameOverScreen.style.display = 'none';
        }
        
        function handleKeyDown(e) {
            if (e.code === 'Space' || e.keyCode === 32) {
                e.preventDefault();
                if (gameStarted && !gameOver) {
                    bird.jump();
                }
            }
        }
        
        function handleTap() {
            if (gameStarted && !gameOver) {
                bird.jump();
                return false; // Prevent default behavior
            }
            return true;
        }
        
        // Handle window resize
        function windowResized() {
            let container = document.getElementById('game-container');
            let containerWidth = container.clientWidth;
            let containerHeight = container.clientHeight;
            
            gameWidth = Math.min(containerWidth, containerHeight * 0.7);
            gameHeight = Math.min(containerHeight, containerWidth * 1.4);
            
            resizeCanvas(gameWidth, gameHeight);
            
            // Update bird position
            if (bird) {
                bird.x = gameWidth * 0.2;
                if (!gameStarted) {
                    bird.y = gameHeight / 2;
                }
            }
            
            // Update text size
            textSize(gameHeight * 0.05);
        }
    </script>
</body>
</html>